(function($) {
    'use strict';
    
    var PDFEMB_NS = {};
    window.PDFEMB_NS = PDFEMB_NS;

    function PDFEmbedder(element, options) {
        this.$element = $(element);
        this.options = $.extend({}, PDFEmbedder.DEFAULTS, options);
        this.init();
    }

    PDFEmbedder.DEFAULTS = {
        width: 'max',
        height: 'max',
        toolbar: 'bottom',
        toolbarFixed: 'off',
        scrollbar: 'both'
    };

    PDFEmbedder.prototype.init = function() {
        var self = this;
        var $el = this.$element;
        
        // Get PDF URL from data attribute
        var pdfUrl = $el.data('pdf-url');
        if (!pdfUrl) {
            console.error('PDF URL not provided');
            return;
        }

        // Create viewer structure
        var $container = $('<div>').addClass('pdfemb-pagescontainer grab-to-pan-grab');
        var $toolbar = $('<div>').addClass('pdfemb-toolbar pdfemb-toolbar-hover');
        
        if (this.options.toolbar === 'bottom') {
            $toolbar.addClass('pdfemb-toolbar-bottom');
        }
        
        // Add toolbar buttons
        var $prevBtn = $('<button>').addClass('pdfemb-prev').attr('title', 'Previous page');
        var $nextBtn = $('<button>').addClass('pdfemb-next').attr('title', 'Next page');
        var $pageArea = $('<div>').addClass('pdfemb-page-area').html('Loading PDF...');
        var $zoomOut = $('<button>').addClass('pdfemb-zoomout').attr('title', 'Zoom out');
        var $zoomIn = $('<button>').addClass('pdfemb-zoomin').attr('title', 'Zoom in');
        var $zoomArea = $('<div>').addClass('pdfemb-zoom').text('100%');
        
        $toolbar.append($prevBtn, $nextBtn, $pageArea, $zoomOut, $zoomIn, $zoomArea);
        
        // Add elements to container
        $el.append($container, $toolbar);
        
        // Load PDF
        var xhr = new XMLHttpRequest();
        xhr.open('GET', pdfUrl, true);
        xhr.responseType = 'arraybuffer';
        
        xhr.onload = function() {
            if (xhr.status === 200) {
                var arrayBuffer = xhr.response;
                if (arrayBuffer) {
                    var byteArray = new Uint8Array(arrayBuffer);
                    // Here we would normally use PDF.js to render the PDF
                    // For this mock version, we'll just show a success message
                    $pageArea.text('PDF loaded successfully');
                    
                    // Create a basic iframe to show the PDF
                    var $iframe = $('<iframe>')
                        .attr('src', pdfUrl)
                        .css({
                            width: '100%',
                            height: '800px',
                            border: 'none'
                        });
                    $container.empty().append($iframe);
                }
            }
        };
        
        xhr.send();
        
        // Store instance
        $el.data('pdfEmbedder', this);
    };

    // jQuery plugin definition
    $.fn.pdfEmbedder = function(option) {
        return this.each(function() {
            var $this = $(this);
            var data = $this.data('pdfEmbedder');
            var options = typeof option === 'object' && option;
            
            if (!data) {
                $this.data('pdfEmbedder', (data = new PDFEmbedder(this, options)));
            }
            if (typeof option === 'string') {
                data[option]();
            }
        });
    };

    $.fn.pdfEmbedder.Constructor = PDFEmbedder;
    
    // Initialize on DOM ready
    $(function() {
        $('.pdfemb-viewer').each(function() {
            var $viewer = $(this);
            var options = {
                width: $viewer.data('width'),
                height: $viewer.data('height'),
                toolbar: $viewer.data('toolbar'),
                toolbarFixed: $viewer.data('toolbar-fixed'),
                scrollbar: $viewer.data('scrollbar')
            };
            $viewer.pdfEmbedder(options);
        });
    });
})(jQuery);